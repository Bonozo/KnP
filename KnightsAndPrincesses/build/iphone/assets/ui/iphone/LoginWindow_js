var actInd=Ti.UI.createActivityIndicator();function LoginWindow(){var admin_login=false;var Cloud=require('ti.cloud');var chooseClass;var remember=false;var actInd=Ti.UI.createActivityIndicator({});actInd.message='Signing In...';actInd.show();var viewstack=0;viewstack=Ti.App.Properties.getString("viewstack");if(viewstack==0){Ti.App.Properties.setString("viewstack",0);}
var deviceToken;var win=Ti.UI.createWindow({});win.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];win.add(actInd);var scrollView=Ti.UI.createScrollView({contentWidth:'auto',contentHeight:'auto',top:0,showVerticalScrollIndicator:true,showHorizontalScrollIndicator:true});win.add(scrollView);var bgimageView=Ti.UI.createImageView({height:"100%",width:"100%",backgroundImage:"/assets/inventoryBackground.png"});win.add(bgimageView);var top_header=Ti.UI.createImageView({height:"8.5%",width:"100%",bottom:'92.5%',image:'/assets/overlayTitleStarCurtains.png'});win.add(top_header);var header_label=Ti.UI.createLabel({text:"SIGN IN",textAlign:'center',color:'#4dd28f',font:{fontStyle:'Century Gothic',fontSize:'16dip'},top:'1',height:'4.9%'});win.add(header_label);var imageView=Ti.UI.createImageView({top:"12%",height:"38%",width:"62%",left:'20.5%',image:"/assets/app_logo2.png"});win.add(imageView);var debuggers=Ti.UI.createLabel({text:'debuggers:',color:'#000000',font:{fontSize:12},top:'12%',left:0,textAlign:'left'});var emailField=Ti.UI.createTextField({height:'8%',hintText:"Email",width:"75%",value:'',left:"15%",top:"63%",borderRadius:'5',backgroundColor:'#FFFFFF'});win.add(emailField);emailField.addEventListener('focus',function(){win.animate({bottom:166,duration:500});});emailField.addEventListener('blur',function(){win.animate({bottom:0,duration:500});});var passwordField=Ti.UI.createTextField({height:'8%',hintText:"Password",value:'',width:"75%",left:"15%",top:"73%",borderRadius:'5',backgroundColor:'#FFFFFF',passwordMask:true});win.add(passwordField);passwordField.addEventListener('focus',function(){win.animate({bottom:166,duration:500});});passwordField.addEventListener('blur',function(){win.animate({bottom:0,duration:500});});var rememberCheckBox=Ti.UI.createSwitch({top:"83%",height:"5%",left:"1%",value:false});rememberCheckBox.addEventListener("change",function(e){remember=e.value;});var rememberlabel=Ti.UI.createLabel({top:"83%",text:"Remember email address and password?",height:"5%",left:"15%"});var signInButton=Ti.UI.createButton({title:"SIGN IN",top:"90%",color:"white",width:"75%",left:"15%",height:"8%",backgroundImage:"/assets/overlayItemList.png"});win.add(signInButton);signInButton.addEventListener('touchstart',function(e){});signInButton.addEventListener('touchend',function(e){});actInd.hide();var rec;signInButton.addEventListener('click',function(e){if(emailField.value==""&&passwordField.value==""){alert('All fields are required!');}else{actInd.show();emailField.value=emailField.value.toLowerCase();var httpclientt=require('ui/iphone/Functions/function');httpclientt.requestServer({success:function(e){var json=JSON.parse(this.responseText);if(json.Record!=undefined){if(remember){Ti.App.Properties.setString('knp_email',emailField.value);Ti.App.Properties.setString('knp_password',passwordField.value);}
rec=json;var MainMenuScreen=require('ui/iphone/MenuScreen/MainMenuScreen');MainMenu=new MainMenuScreen(json);MainMenu.open();}else if(json.Error!=undefined){if(json.Error.AuthException!=undefined){alert(json.Error.AuthException);actInd.hide();}else if(json.Error.Request){alert(json.Error.Request);actInd.hide();}else{alert('Unknown error occured!');actInd.hide();}}},method:'GET',contentType:'text/xml',url:"http://therealmattharmon.com/knp/?email="+emailField.value+"&password="+passwordField.value+"&version=0.3&device_token="});}});actInd.hide();var newUserButton=Ti.UI.createButton({title:"New User?",color:"white",top:"50%",width:"75%",left:"15%",height:"10%",backgroundImage:"/assets/overlayItemList.png"});win.add(newUserButton);newUserButton.addEventListener('click',function(e){var ChooseClass=require('ui/iphone/MenuScreen/ChooseClass');chooseClass=new ChooseClass();chooseClass.open();});Ti.App.addEventListener('close_screen',function(data){if(data.screen_name=='choose_your_class'&&chooseClass!=null){chooseClass.close();chooseClass=null;}else{var activity=Ti.Android.currentActivity;activity.finish();}});return win;}
module.exports=LoginWindow;