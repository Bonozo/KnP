function ArcheryMainGame(e,t,i,n,a){function o(e,t){return"x"==e?y*t/100:"y"==e?L*t/100:void 0}function r(e,t){return e*t}function s(e,t){return e/t}function d(a,o){nt="http://bonozo.com:8080/knp/knp_set_quest_status.php?game_status=COMPLETE&quest_status="+e+"&assign_quest_id="+n+"&quest_id="+t+"&uid="+i.Record[0].UID+"&friend_uid="+i.Record[0].UID,Ti.API.info(nt),it.requestServer({success:function(){if(at=JSON.parse(this.responseText),void 0!=at.Record&&"Updated!"==at.Record[0].Message){Ti.App.fireEvent("game_played",{status:"complete"});var e=0,t="",r="";for(var s in at.Record[0]){if(at.Record[0].hasOwnProperty(s)){{s+" -> "+at.Record[0][s]}1==e?t=at.Record[0][s]:e>1&&(r+="\n"+s+"("+at.Record[0][s]+")")}e++}nt="http://bonozo.com:8080/knp/earned_quest_rewards.php?uid="+i.Record[0].UID+"&assign_quest_id="+n+"&inv_id=10004&qty="+a,it.requestServer({success:function(){at=JSON.parse(this.responseText),void 0!=at.Record&&""!=at.Record.Message&&o(t,r),Ti.App.fireEvent("update_xp",{clicked_item:"StatusScreen"})},method:"GET",contentType:"text/xml",url:nt})}Ti.App.fireEvent("update_xp",{clicked_item:"StatusScreen"})},method:"GET",contentType:"text/xml",url:nt})}function c(e,t,i){return Ti.API.info("indicator_y_pointer.x: "+It.x),Ti.API.info("indicator_y_pointer.y: "+It.y),Ti.API.info("indicator_y_pointer.width: "+It.width),Ti.API.info("indicator_y_pointer.height: "+It.height),e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height?!0:!1}function l(e,t,i,n,a,o){Ti.API.info(e+", "+t+", "+i+", "+n+", "+a+", "+o);var r=Math.pow(e-i,2)+Math.pow(t-n,2),s=Math.pow(a,2);return r==s||r>=s&&s+o>=r||s>r&&r>=s-o?!0:!1}var u=Ti.Platform.osname,p=void 0==Ti.App.Properties.getString("knp_sound")||""==Ti.App.Properties.getString("knp_sound")||null==Ti.App.Properties.getString("knp_sound")?"ON":Ti.App.Properties.getString("knp_sound"),h=Ti.UI.createWindow({orientation:Ti.UI.PORTRAIT,navBarHidden:!0,fullscreen:!0}),g=Titanium.Media.createSound({url:"/sounds/trumpet_lose.mp3"}),m=Titanium.Media.createSound({url:"/sounds/trumpet_win.mp3"});h.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];var f=0,T=0,I=0,v=require("com.googlecode.quicktigame2d"),_=Titanium.Media.createSound({url:"/sounds/ambient_bird_chirps.mp3"}),E=!0,R=!0,A=function(){if("OFF"!=p)if(R){if(!E||void 0==_||""==_||null==_)return;R=!1,_.stop(),_.play(),A()}else setTimeout(function(){E&&void 0!=_&&""!=_&&null!=_&&(_.stop(),_.play(),A())},41e3)};!function(){void 0!=_&&""!=_&&null!=_&&(_.play(),A())}();var b=Titanium.Media.createSound({url:"/sounds/arrow_draw.mp3"}),w=Titanium.Media.createSound({url:"/sounds/arrow_fly.mp3"}),x=Titanium.Media.createSound({url:"/sounds/arrow_hit.mp3"}),S=Titanium.Media.createSound({url:"/sounds/arrow_miss.mp3"}),U=v.createGameView();U.fps=30,U.color(0,0,0),U.debug=!0;var y,L,P=(new Array,v.createScene());U.pushScene(P);var N=1,k=v.createSprite({image:"assets/games/archery/background.png",width:y,height:L});P.add(k);var M=o("x",30),C=v.createSprite({image:"assets/games/archery/bullseye.png",width:M,height:M,x:o("x",50)-M/2,y:o("y",50)-M/2,z:4});P.add(C);var G=v.createSprite({image:"assets/XPBar.png",height:o("y",5),width:o("x",100),x:0,y:0,z:4});P.add(G);var z=Ti.UI.createLabel({text:"Shot # 0",color:"#000000",font:{fontSize:"16dip"},left:"2%",top:"1%",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,zIndex:600});h.add(z);var D=o("x",60),O=D/4.81818182,q=Ti.UI.createImageView({width:D,height:O,visible:!1,zIndex:990});h.add(q);var F=Ti.UI.createLabel({text:"Total points : 0",color:"#000000",font:{fontSize:"16dip"},right:"5%",top:"1%",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,zIndex:600});h.add(F);var V=1.78515625,W=o("x",55),j=r(W,V),B=0,Q=40,H=20,Y=-40,J=0,K=-20,X=v.createSprite({image:"assets/games/archery/bow.png",width:W,height:j,x:K,y:L-(3*j/4+H),z:5});P.add(X);var Z=3.5555,$=o("x",20),et=r($,Z),tt=v.createSprite({image:"assets/games/archery/arrow.png",width:$,height:et,x:o("x",53)-$/2+K,y:L-(3*et/4+H),z:6});P.add(tt),_.addEventListener("complete",function(){}),U.addEventListener("onload",function(){"ON"==p&&_.play(),y=U.screen.width,L=U.screen.height,N=U.screen.width/U.size.width,U.registerForMultiTouch(),U.start(),k.width=y,k.height=L,M=o("x",30),C.width=M,C.height=M,C.x=o("x",50)-M/2,C.y=o("y",50)-M/2,G.height=o("y",5),G.width=o("x",100),W=o("x",55),j=r(W,V),X.width=W,X.height=j,X.x=K,X.y=L-(3*j/4+H),$=o("x",20),et=r($,Z),tt.width=$,tt.height=et,tt.x=o("x",53)-$/2+K,tt.y=L-(3*et/4+H),Ut=tt.y,yt=tt.y,Lt=tt.y+60,st=o("y",32),dt=s(st,rt),ct.width=dt,ct.height=st,ct.x=y-o("x",6),ct.y=o("y",15),ut=o("x",10),pt=r(ut,lt),It.width=ut,It.height=pt,It.x=y-o("x",10),It.y=ct.y+ct.height/2-pt/2,gt=ct.y-It.height/2,mt=ct.y+ct.height-It.height/2,ft=mt-gt,Tt=ft/Q,Ti.API.info("indicator_y_pointer.x: "+It.x),Ti.API.info("indicator_y_pointer.y: "+It.y),Ti.API.info("indicator_y_pointer.width: "+It.width),Ti.API.info("indicator_y_pointer.height: "+It.height),Rt=o("x",50),At=r(Rt,Et),bt.width=Rt,bt.height=At,bt.x=o("x",6),bt.y=L-o("y",6),St.width=ut,St.height=pt,St.x=o("x",6)/2+Rt,St.y=L-o("y",6)-pt/2,wt=bt.x-St.width/2,xt=bt.x+bt.width-St.width/2});var it=require("/ui/common/Functions/function");if(a){var nt="http://bonozo.com:8080/knp/knp_assign_quests.php?assign_by_uid="+i.Record[0].UID+"&assign_to_uid="+i.Record[0].UID+"&quest_ids="+t+"&message=Single Player Game&num_of_hours=3&status=SINGLE_PLAYER_GAME",at="",ot=0;it.requestServer({success:function(){at=JSON.parse(this.responseText),ot=at.Record.length,void 0!=at.Record&&(n=at.Record[0].ASSIGN_QUEST_ID)},method:"GET",contentType:"text/xml",url:nt})}U.addEventListener("click",function(){});var rt=50.14285,st=o("y",32),dt=s(st,rt),ct=v.createSprite({image:"assets/games/archery/indicator_y_bg.png",width:dt,height:st,x:y-o("x",6),y:o("y",15),z:500});P.add(ct);var lt=1.084745,ut=o("x",10),pt=r(ut,lt),ht=Ti.UI.createLabel({text:"("+(y-o("y",4.5))+", "+o("x",.5)+"): "+ut+"x"+pt,color:"#000000",font:{fontSize:"14dip"},visible:!1,top:0,zIndex:700});h.add(ht);var gt,mt,ft,Tt,It=v.createSprite({image:"assets/games/archery/indicator_pointer.png",width:ut,height:pt,x:y-o("x",10),y:ct.y+ct.height/2-pt/2,z:510}),vt=0;P.add(It);var _t=!1;ht.text="("+o("y",4.5)+", "+o("x",10)+"): "+ut+"x"+pt;var Et=.019943,Rt=o("x",50),At=r(Rt,Et),bt=v.createSprite({image:"assets/games/archery/indicator_x_bg.png",width:Rt,height:At,x:o("x",6),y:L-o("y",6),z:500});P.add(bt);var wt,xt,ft,St=v.createSprite({image:"assets/games/archery/indicator_pointer.png",width:ut,height:pt,x:o("x",6)/2+Rt,y:L-o("y",6)-pt/2,z:510}),Tt=ft/Q,vt=0;P.add(St);var Ut,yt,Lt,Pt=!1,Nt=!1,kt={},Mt=!1;U.addEventListener("touchstart",function(e){var t=U.screen.width,i=U.screen.height,n=Titanium.Platform.displayCaps.platformWidth,a=Titanium.Platform.displayCaps.platformHeight;t>n?(e.x=t/n*e.x,e.y=i/a*e.y):(e.x=n/t*e.x,e.y=a/i*e.y),It.width=ut,It.height=pt,Ti.API.info("indicator_y_pointer.x: "+It.x),Ti.API.info("indicator_y_pointer.y: "+It.y),Ti.API.info("indicator_y_pointer.width: "+It.width),Ti.API.info("indicator_y_pointer.height: "+It.height),c(e.x,e.y,It)?_t=!0:c(e.x,e.y,St)?Pt=!0:Mt||(Mt=!0,Nt=!0,kt.x=e.x,kt.y=e.y),Ti.API.info(tt.y)});var Ct={},Gt=0,zt=0;U.addEventListener("touchmove",function(e){var t=U.screen.width,i=U.screen.height;y=U.screen.width,L=U.screen.height;var n=Titanium.Platform.displayCaps.platformWidth,a=Titanium.Platform.displayCaps.platformHeight;t>n?(e.x=t/n*e.x,e.y=i/a*e.y):(e.x=n/t*e.x,e.y=a/i*e.y),Ti.API.info(_t+","+e.y+","+gt+","+mt),_t&&e.y>=gt&&e.y<=mt?((e.y%Tt>=-vt||e.y%Tt<vt)&&(Ct.y<e.y?(ht.text=H+" > "+B+" > "+Q,H>B+1&&(Gt--,H--)):Q-1>H&&(H++,Gt++)),Ti.API.info(L-(3*j/4+H)),X.y=L-(3*j/4+H),tt.y=L-(3*et/4+H),It.y=e.y,Ut=tt.y,yt=tt.y,Lt=tt.y+60,Ti.API.info("first")):Pt&&e.x>=wt&&e.x<=xt?(Ti.API.info("Condition true"),(e.x%Tt>=-vt||e.x%Tt<vt)&&(Ct.x<e.x?J+1>K&&(zt++,K++):K>Y-1&&(zt--,K--),X.x=K,tt.x=o("x",53)-$/2+K),ht.text=K+" > "+Y+" > "+J,St.x=e.x,Ti.API.info("second")):Nt&&Ct.y<e.y?(Lt-1>Ut&&("ON"==p&&b.play(),zt++,Ut++),tt.y=Ut,ht.text=Ut+" :: "+yt+" :: "+Lt,Ti.API.info("third")):Nt&&Ct.y>e.y?(Ut>yt+1&&("ON"==p&&b.play(),Ut--,zt--),tt.y=Ut,ht.text=Ut+" :: "+yt+" :: "+Lt,Ti.API.info("fourth")):Ti.API.info("fifth"),ht.text=C.collidesWith(tt),Ct.x=e.x,Ct.y=e.y}),U.addEventListener("touchend",function(e){var t=U.screen.width,i=U.screen.height,n=Titanium.Platform.displayCaps.platformWidth,a=Titanium.Platform.displayCaps.platformHeight;if(t>n?(e.x=t/n*e.x,e.y=i/a*e.y):(e.x=n/t*e.x,e.y=a/i*e.y),_t)_t=!1;else if(Pt)Pt=!1;else if(Nt){Nt=!1;var r=v.createTransform();r.duration=200,r.scale_centerX=tt.width/2,r.scale_centerY=0,r.scale(.3,.3),r.easing=v.ANIMATION_CURVE_EASE_IN,r.y=o("y",30)+(L-tt.y)-4*Gt-4*zt,r.x=kt.x>e.x?tt.x+2*(kt.x-e.x):tt.x-2*(e.x-kt.x),r.z=4,tt.transform(r),ht.text=7*(L-Ut)/5+o("x",40),"ON"==p&&w.play(),setTimeout(function(){if(E){I++,w.stop(),b.stop(),ht.text=tt.x+tt.width/2+", "+tt.y;for(var e=M/2/4,t=!1,i=C.x+C.width/2,n=C.y+C.height/2,a=0,r=30,c=a;e>c;c+=1)if(a=c,l(tt.x+tt.width/2,tt.y,i,n,c,r)){t=!0;break}if(t)f=100;else{for(var u=M/2/2,r=70,c=a;u>c;c+=1)if(a=c,l(tt.x+tt.width/2,tt.y,i,n,c,r)){t=!0;break}if(t)f=80;else{for(var r=80,v=M/2*3/4,c=a;v>c;c+=1)if(a=c,l(tt.x+tt.width/2,tt.y,i,n,c,r)){t=!0;break}if(t)f=50;else{for(var r=100,_=M/2,c=a;_>c;c+=1)if(a=c,l(tt.x+tt.width/2,tt.y,i,n,c,r)){t=!0;break}t&&(f=25)}}}if("ON"==p&&(t?x.play():S.play()),T+=f,5==I){var R=T/500*100,A=Math.ceil(5*(R/100));return d(50*A,function(){switch(A>3?m.play():g.play(),Dt.visible=!0,A){case 0:q.image="/assets/games/ratings/5_star_ratings_1.png";break;case 1:q.image="/assets/games/ratings/5_star_ratings_1.png";break;case 2:q.image="/assets/games/ratings/5_star_ratings_2.png";break;case 3:q.image="/assets/games/ratings/5_star_ratings_3.png";break;case 4:q.image="/assets/games/ratings/5_star_ratings_4.png";break;case 5:q.image="/assets/games/ratings/5_star_ratings_5.png"}q.visible=!0,setTimeout(function(){h.close()},4e3)}),void 0}setTimeout(function(){E&&(Dt.visible=!0,Ot.text=0!=f?"You have earned "+f+" more points!\nGet ready for the next shot.":"You earned no point.\nGet ready for the next shot.",Ot.visible=!0,setTimeout(function(){E&&(Dt.visible=!1,Ot.visible=!1,F.text="Total points : "+T,z.text="Shot # "+I,Gt=0,zt=0,f=0,ht.text=C.collidesWith(tt),B=0,Q=40,H=20,Y=-40,J=0,K=-20,Ut=yt,X.y=L-(3*j/4+H),X.x=K,tt.z=6,tt.scale(1),tt.x=o("x",53)-$/2+K,tt.y=L-(3*et/4+H),Ut=tt.y,yt=tt.y,Lt=tt.y+60,s.visible=!1,Mt=!1)},3e3))},1e3)}},300);var s=Ti.UI.createButton({color:"#761f56",title:"Reset",top:o("y",10),zIndex:900});s.addEventListener("click",function(){Gt=0,zt=0,f=0,ht.text=C.collidesWith(tt),B=0,Q=40,H=20,Y=-40,J=0,K=-20,Ut=yt,X.y=L-(3*j/4+H),X.x=K,tt.z=6,tt.scale(1),tt.x=o("x",53)-$/2+K,tt.y=L-(3*et/4+H),Ut=tt.y,yt=tt.y,Lt=tt.y+60,s.visible=!1,Mt=!1})}Ti.API.info(tt.y)});h.addEventListener("close",function(){E=!1,_.stop()}),h.addEventListener("open",function(){if("android"===u){var e=h.activity;e.addEventListener("resume",function(){}),e.addEventListener("pause",function(){E=!1,_.stop()}),e.addEventListener("destroy",function(){E=!1,_.stop()})}});var Dt=(o("x",70),Ti.UI.createImageView({image:"/assets/games/scroll.png",width:o("x","85"),height:r(o("x","85"),1.3),zIndex:890,visible:!1}));h.add(Dt);var Ot=Ti.UI.createLabel({color:"#000000",font:{fontSize:"14dip",fontWeight:"bold"},textAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,left:"22%",visible:!1,width:"48%",height:"100%",zIndex:900});return h.add(Ot),h.add(U),h.open({fullscreen:!0,navBarHidden:!0}),h}module.exports=ArcheryMainGame;