function JoustinGamePlay(e,t,i){function n(e,t){return"x"==e?s*t/100:"y"==e?d*t/100:void 0}function a(e,t,i){var n=e*i/100;return n/t}function o(){A.scaleFromCenter(a(s,196.25,16),a(d,256,21),0,0),A.x=n("x",38),A.y=n("y",39.5)}var r=Ti.UI.createWindow({orientation:Ti.UI.PORTRAIT,navBarHidden:!0,fullscreen:!0});self.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];var s=Ti.Platform.displayCaps.platformWidth,d=Ti.Platform.displayCaps.platformHeight,c=require("com.googlecode.quicktigame2d"),l=c.createGameView();l.fps=30,l.color(0,0,0),l.debug=!0;var u=(new Array,!1),p=c.createScene();l.pushScene(p);var h=0,g=1,m=Titanium.Media.createSound({url:"/sounds/horse_gollap_noise.mp3",looping:!0}),f=Titanium.Media.createSound({url:"/sounds/whoosh.mp3"}),T=c.createSprite({image:"assets/games/jousting/sky_image.png",width:n("x",100),height:n("y",50),x:n("x",0),y:n("y",0)});p.add(T);var I=c.createSprite({image:"assets/joust_avatar_right.png",width:n("x",15),height:n("y",15),x:n("x",85),y:n("x",0),z:5});p.add(I);var v=c.createSprite({image:"assets/joust_avatar_left.png",width:n("x",15),height:n("y",15),x:n("x",0),y:n("x",0),z:5});p.add(v);var _=c.createSprite({image:"assets/energy_bar.png",width:n("x",17),height:n("y",3),x:n("x",0),y:n("x",21),z:5});p.add(_);var E=c.createSprite({image:"assets/energy_bar.png",width:n("x",17),height:n("y",3),x:n("x",85),y:n("x",21),z:5});p.add(E);var R=c.createSpriteSheet({image:"assets/games/jousting/spritesheet_grass.png",width:400,height:198,x:n("x",0),y:n("y",50)}),b=c.createSprite({image:"assets/Joust_TargetingOnTarget.png",width:n("x",30),height:n("y",30)}),x=c.createSprite({image:"assets/games/jousting/lance.png",width:n("x",30),height:n("y",35),z:6}),A=c.createSpriteSheet({image:"assets/games/jousting/ldpi_horse_spritesheet.png",width:196.25,height:256,x:n("x",38),y:n("y",39.5),z:0}),w=c.createSpriteSheet({image:"assets/games/jousting/spritesheet_rail.png",width:200,height:193,x:n("x",0),y:n("y",50),z:2});l.addEventListener("onload",function(){g=l.screen.width/l.size.width,l.registerForMultiTouch(),l.start()});var S="http://bonozo.com:8080/knp/knp_assign_quests.php?assign_by_uid="+i.Record[0].UID+"&assign_to_uid="+i.Record[0].UID+"&quest_ids="+t+"&message=Single Player Game&num_of_hours=3&status=SINGLE_PLAYER_GAME",U="",y=0,L=require("/ui/common/Functions/function");L.requestServer({success:function(){U=JSON.parse(this.responseText),y=U.Record.length,void 0!=U.Record&&(_assign_quest_id=U.Record[0].ASSIGN_QUEST_ID)},method:"GET",contentType:"text/xml",url:S});var k=0;l.addEventListener("onloadsprite",function(){k++});var N=0,P=0;r.addEventListener("open",function(){R.scaleFromCenter(a(s,400,100),a(d,198,50),0,0),p.add(R),w.scaleFromCenter(a(s,200,50),a(d,193,50),0,0),p.add(w);var e=r.activity;e.addEventListener("resume",function(){p.add(x),x.hide(),p.add(A),A.hide(),R.animate([0,1,2,3],150,-1,0),w.animate([0,1,2,3],200,-1,0),A.animate([0,1,2,3,4,5,6,7],50,-1,0);var e=c.createTransform();e.duration=3e3,e.scale_centerX=0,e.scale_centerY=0,e.scaleX=a(s,196.25,85),e.scaleY=a(d,256,72.37);var t=c.createTransform();t.duration=3e3,t.move(-90,n("y",25)),h=setInterval(function(){o(),A.show(),A.transform(e),A.transform(t),m.stop(),m.play()},3e3)}),e.addEventListener("pause",function(){m.stop(),f.stop(),clearInterval(h),h=null}),e.addEventListener("destroy",function(){m.stop(),f.stop(),clearInterval(h),h=null})}),l.addEventListener("click",function(){u?alert("You have already played this quest!\nPress back button"):(S="http://bonozo.com:8080/knp/knp_set_quest_status.php?game_status=COMPLETE&quest_status="+e+"&assign_quest_id="+_assign_quest_id+"&quest_id="+t+"&uid="+i.Record[0].UID+"&friend_uid="+i.Record[0].UID,L.requestServer({success:function(){if(U=JSON.parse(this.responseText),void 0!=U.Record&&"Updated!"==U.Record[0].Message){Ti.App.fireEvent("game_played",{status:"complete"});var e=0,t="",i="";for(var n in U.Record[0]){if(U.Record[0].hasOwnProperty(n)){{n+" -> "+U.Record[0][n]}1==e?t=U.Record[0][n]:e>1&&(i+="\n"+n+"("+U.Record[0][n]+")")}e++}var a=Titanium.UI.createAlertDialog({title:"You have completed "+t+".",message:"Rewards earned:"+i,buttonNames:["OK"]});a.show(),a.addEventListener("click",function(){r.close()})}Ti.App.fireEvent("update_xp",{clicked_item:"StatusScreen"})},method:"GET",contentType:"text/xml",url:S}),u=!0)});var C=function(e){for(var t in e.points)0==P&&(b.x=e.points[t].x,b.y=e.points[t].y,P++),b.z=2,x.x=e.points[t].x,x.y=e.points[t].y,x.z=2,0==N&&(p.add(b),x.show(),f.play(),N++),"touchmove"==e.type&&(p.remove(b),x.center={x:32+e.points[t].x*g,y:43+e.points[t].y*g}),b.center={x:e.points[t].x*g,y:e.points[t].y*g},x.center={x:32+e.points[t].x*g,y:43+e.points[t].y*g}},z=function(e){Ti.API.info(e.type+": "+JSON.stringify(e.points)),p.remove(b),N=0;for(var t in e.points);"touchend"==e.type};return l.addEventListener("touchstart",C),l.addEventListener("touchmove",C),l.addEventListener("touchstart_pointer",C),l.addEventListener("touchend",z),l.addEventListener("touchend_pointer",z),r.add(l),r.open({fullscreen:!0,navBarHidden:!0}),r}module.exports=JoustinGamePlay;