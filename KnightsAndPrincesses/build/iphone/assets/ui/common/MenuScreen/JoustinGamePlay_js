function JoustinGamePlay(e,t,i,n,a){function o(e,t){return"x"==e?f*t/100:"y"==e?m*t/100:void 0}function r(e,t,i){var n=e*i/100;return n/t}function s(e,t){return e*t}function d(e,t){return e/t}function c(e,t){var i=e+Math.random()*(t-e);return Math.round(i)}function l(a,o){return Ti.Network.online?(dt="http://bonozo.com:8080/knp/knp_set_quest_status.php?game_status=COMPLETE&quest_status="+e+"&assign_quest_id="+n+"&quest_id="+t+"&uid="+i.Record[0].UID+"&friend_uid="+i.Record[0].UID,st.requestServer({success:function(){if(ct=JSON.parse(this.responseText),void 0!=ct.Record&&"Updated!"==ct.Record[0].Message){Ti.App.fireEvent("game_played",{status:"complete"});var e=0,t="",r="";for(var s in ct.Record[0]){if(ct.Record[0].hasOwnProperty(s)){{s+" -> "+ct.Record[0][s]}1==e?t=ct.Record[0][s]:e>1&&(r+="\n"+s+"("+ct.Record[0][s]+")")}e++}dt="http://bonozo.com:8080/knp/earned_quest_rewards.php?uid="+i.Record[0].UID+"&assign_quest_id="+n+"&inv_id=10004&qty="+a,st.requestServer({success:function(){ct=JSON.parse(this.responseText),void 0!=ct.Record&&""!=ct.Record.Message&&o(t,r),Ti.App.fireEvent("update_xp",{clicked_item:"StatusScreen"})},method:"GET",contentType:"text/xml",url:dt})}Ti.App.fireEvent("update_xp",{clicked_item:"StatusScreen"})},method:"GET",contentType:"text/xml",url:dt}),void 0):(o(null,null),void 0)}var u=Ti.Platform.osname,p=void 0==Ti.App.Properties.getString("knp_sound")||""==Ti.App.Properties.getString("knp_sound")||null==Ti.App.Properties.getString("knp_sound")?"ON":Ti.App.Properties.getString("knp_sound"),h=Ti.UI.createWindow({orientation:Ti.UI.PORTRAIT,navBarHidden:!0,fullscreen:!0,statusBarStyle:Titanium.UI.iPhone.statusBarHidden});h.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];var g=!0,f=Ti.Platform.displayCaps.platformWidth,m=Ti.Platform.displayCaps.platformHeight,T=require("com.googlecode.quicktigame2d"),I=T.createGameView();I.fps=60,I.color(0,0,0),I.debug=!0;var v,E,_=!0,b=Titanium.Media.createSound({url:"/sounds/jousting_battle_music.mp3"}),R=Titanium.Media.createSound({url:"/sounds/metal_bang.mp3"}),x=Titanium.Media.createSound({url:"/sounds/trumpet_lose.mp3"}),A=Titanium.Media.createSound({url:"/sounds/trumpet_win.mp3"}),w=Titanium.Media.createSound({url:"/sounds/horse_gollap_noise.mp3",looping:!0}),S=Titanium.Media.createSound({url:"/sounds/whoosh.mp3"}),U=0,y=0,L=0,k=T.createScene();I.pushScene(k);var N=1,P=T.createSprite({image:"assets/XPBar.png",height:o("y",5),width:o("x",100),tag:"scoreboard",x:0,y:0,z:4}),C=Ti.UI.createLabel({text:"Shot # 0",color:"#000000",font:{fontSize:"16dip"},left:"2%",top:"1%",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,zIndex:600});h.add(C);var z=Ti.UI.createLabel({text:"Total points : 0",color:"#000000",font:{fontSize:"16dip"},right:"5%",top:"1%",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,zIndex:600});h.add(z);var M=T.createSprite({image:"assets/games/jousting/sky_image.png",width:400,height:200,tag:"sky",x:o("x",100),y:o("y",100),z:0}),G=T.createSpriteSheet({image:"assets/games/jousting/spritesheet_grass.png",width:400,height:197,tag:"spritesheet_grass",x:o("x",0),y:o("y",55),z:1}),D=1.92517007,F=o("y",10),O=d(F,D),q=(T.createSprite({image:"assets/Joust_TargetingOnTarget.png",width:O,height:F,tag:"lance",x:0,y:0,z:6}),T.createSprite({image:"assets/games/jousting/horizontal_bar.png",width:o("x",5),height:o("x",5),tag:"horizontal_bar",x:o("x",100),y:o("y",100),z:7})),V=T.createSprite({image:"assets/games/jousting/vertical_bar.png",width:o("x",5),height:o("x",5),tag:"vertical_bar",x:o("x",100),y:o("y",100),z:7}),B=T.createSprite({image:"assets/games/jousting/balance_bar.png",width:o("x",35),height:o("x",35),tag:"balance_bar",x:o("x",90)-o("x",35),y:o("y",90)-o("x",35),z:7}),j=T.createSprite({image:"assets/games/jousting/bar_button_down.png",width:o("x",10),height:o("x",10),tag:"bar_button_down",x:o("x",10),y:o("y",10),z:8}),W=T.createSprite({image:"assets/games/jousting/bar_button_left.png",width:o("x",10),height:o("x",10),tag:"bar_button_left",x:o("x",100),y:o("y",100),z:8}),Q=T.createSprite({image:"assets/games/jousting/bar_button_right.png",width:o("x",10),height:o("x",10),tag:"bar_button_right",x:o("x",100),y:o("y",100),z:8}),H=T.createSprite({image:"assets/games/jousting/bar_button_up.png",width:o("x",10),height:o("x",10),tag:"bar_button_up",x:o("x",100),y:o("y",100),z:8}),Y=T.createSprite({image:"assets/games/jousting/lance.png",width:298,height:534,tag:"lance_green",z:7}),K=1.30612245,J=o("x",20),X=(s(J,K),{width:196,height:256}),Z=o("y",20),$=T.createSpriteSheet({image:"assets/games/jousting/ldpi_horse_spritesheet.png",width:X.width,height:X.height,tag:"knight_image",x:o("x",100),y:o("y",100),z:2}),et=o("x",30),tt=et/4.81818182,it=Ti.UI.createImageView({width:et,height:tt,left:o("x","34"),top:o("x","15")+s(o("x","50"),1.3)/2,visible:!1,zIndex:990});h.add(it);var nt=T.createSpriteSheet({image:"assets/games/jousting/spritesheet_rail.png",width:200,height:187,tag:"rails_image",x:0,y:o("y",52),z:3}),at=T.createSprite({image:"assets/games/jousting/rail_highlight.png",width:200,height:187,tag:"rail_highlight_image",x:0,y:o("y",52),z:4}),ot=T.createTransform(),rt=function(){nt.animate([0,1,2,3],100,-1,0),G.animate([0,1,2,3],100,-1,0),$.hide(),$.animate([0,1,2,3,4,5,6,7],50,-1,0);var e=o("y",10),t=.765625*e;if(void 0!=T&&null!=T){if($.scale(t/X.width,e/X.height),U>4){var i=y/500*100,n=Math.ceil(5*(i/100));return l(50*n,function(e,t){if(null==e||null==t)return alert("Your internet connection is down!"),setTimeout(function(){h.close()},2e3),void 0;switch(n>3?A.play():x.play(),yt.visible=!1,Ut.visible=!0,q.hide(),V.hide(),B.hide(),Y.hide(),j.hide(),W.hide(),Q.hide(),H.hide(),n){case 0:it.image="/assets/games/ratings/5_star_ratings_1.png";break;case 1:it.image="/assets/games/ratings/5_star_ratings_1.png";break;case 2:it.image="/assets/games/ratings/5_star_ratings_2.png";break;case 3:it.image="/assets/games/ratings/5_star_ratings_3.png";break;case 4:it.image="/assets/games/ratings/5_star_ratings_4.png";break;case 5:it.image="/assets/games/ratings/5_star_ratings_5.png"}it.visible=!0,setTimeout(function(){h.close()},4e3)}),$.stop(),$.clearTransforms(),G.stop(),nt.stop(),void 0}q.show(),V.show(),B.show(),j.show(),W.show(),Q.show(),H.show(),$.x=o("x",52)-t,$.y=o("y",58)-e,vt(),It=!1,setTimeout(function(){if(g&&!(U>4||void 0==$||null==$||""==$||void 0==o)&&_){var i=$.width*$.scaleX,n=$.width;if(n>i)var a=$.x-(n-i)/2;else if(i>n)var a=$.x+(i-n)/2;var r=$.height*$.scaleY,s=$.height;if(s>r)var d=$.y-(s-r)/2;else if(r>s)var d=$.y+(r-s)/2;s!=r&&($.x=a,$.y=d),0==U&&$.show(),$.show(),ot.duration=3e3,ot.easing=T.ANIMATION_CURVE_EASE_IN,e=o("y",90),t=.765625*e,ot.scaleX=t/X.width*1.5,ot.scaleY=e/X.height*1.5,ot.move(o("x",0)-t,o("y",55)),"ON"==p&&(w.play(),w.setLooping(!0)),$.transform(ot),U++,C.text="Shot # "+U}},3e3)}};ot.addEventListener("complete",function(){$.stop(),$.clearTransforms(),w.stop(),nt.stop(),G.stop(),yt.text="You have earned "+L+" more points.\nGet ready for the next shot.",setTimeout(function(){g&&(yt.visible=!0,Ut.visible=!0,q.hide(),V.hide(),B.hide(),j.hide(),W.hide(),Q.hide(),Y.hide(),H.hide(),setTimeout(function(){g&&(yt.visible=!1,Ut.visible=!1,q.show(),V.show(),B.show(),j.show(),W.show(),Q.show(),H.show(),Y.show())},3e3))},3e3)}),I.addEventListener("onload",function(){f=I.screen.width,m=I.screen.height,N=I.screen.width/I.size.width,I.registerForMultiTouch(),I.start(),P.height=o("y",5),P.width=o("x",100),k.add(P),Y.hide(),k.add(Y),M.x=0,M.y=0,M.scaleFromCenter(r(m,200,55),r(m,200,55),0,0),k.add(M);var e=o("y",20),t=.765625*e;$.x=o("x",52)-t,$.y=o("y",58)-e,$.hide(),$.animate([0,1,2,3,4,5,6,7],50,-1,0),k.add($),B.x=o("x",90)-o("x",35),B.y=o("y",90)-o("x",35),B.width=o("x",35),B.height=o("x",35),k.add(B),v={x_left:B.x+25*B.width*B.scaleX/100,x_right:B.x+75*B.width*B.scaleX/100,x_width:B.x+75*B.width*B.scaleX/100-(B.x+75*B.width*B.scaleX/100)},E={y_top:B.y+25*B.height*B.scaleY/100,y_bottom:B.y+75*B.height*B.scaleY/100,y_height:B.y+75*B.height*B.scaleY/100-(B.y+25*B.height*B.scaleY/100)},j.width=o("x",10),j.height=o("x",10),j.x=B.x+B.width/2-j.width/2,j.y=B.y+B.height-j.height/2,k.add(j),H.width=o("x",10),H.height=o("x",10),H.x=B.x+B.width/2-H.width/2,H.y=B.y-j.height/2,k.add(H),W.width=o("x",10),W.height=o("x",10),W.x=B.x-W.width/2,W.y=B.y+B.height/2-W.height/2,k.add(W),Q.width=o("x",10),Q.height=o("x",10),Q.x=B.x+B.width-Q.width/2,Q.y=B.y+B.height/2-Q.height/2,k.add(Q),V.width=o("x",5),V.height=o("x",5),V.x=B.x+B.width/2-V.width/2,V.y=B.y,q.width=o("x",5),q.height=o("x",5),q.x=B.x,q.y=B.y+B.height/2-q.height/2,k.add(q),k.add(V),vt(),nt.animate([0,1,2,3],100,-1,0),G.x=o("x",0),G.y=o("y",55),G.animate([0,1,2,3],100,-1,0),G.scaleFromCenter(r(f,400,100),r(m,197,45),0,0),k.add(G),at.y=o("y",52),at.alpha=.5,at.scaleFromCenter(r(f,200,50),r(m,187,48),0,0),k.add(at),Y.x=0,Y.y=o("y",40),Y.scaleFromCenter(r(f,298,64),r(m,534,64),0,0),Y.show(),nt.y=o("y",52),nt.scaleFromCenter(r(f,200,50),r(m,187,48),0,0),k.add(nt)});var st=require("/ui/common/Functions/function");if(a){var dt="http://bonozo.com:8080/knp/knp_assign_quests.php?assign_by_uid="+i.Record[0].UID+"&assign_to_uid="+i.Record[0].UID+"&quest_ids="+t+"&message=Single Player Game&num_of_hours=3&status=SINGLE_PLAYER_GAME",ct="",lt=0;st.requestServer({success:function(){ct=JSON.parse(this.responseText),lt=ct.Record.length,void 0!=ct.Record&&(n=ct.Record[0].ASSIGN_QUEST_ID)},method:"GET",contentType:"text/xml",url:dt})}var ut=["scoreboard","sky","spritesheet_grass","lance","horizontal_bar","vertical_bar","balance_bar","bar_button_down","bar_button_left","bar_button_right","bar_button_up","lance_green","knight_image","rails_image","rail_highlight_image"],pt=0,ht=c(B.x,B.x+B.width),gt=c(B.y,B.y+B.height),ft=!0,mt=!0,Tt=3,It=!1,vt=function(){setTimeout(function(){if(g){ft?(q.x+=Tt,Y.x+=Tt,Ti.API.info(q.x+" >= "+ht),q.x>=ht&&(ft=!1,ht=c(B.x,B.x+B.width/2))):(q.x-=Tt,Y.x-=Tt,q.x<=ht&&(ft=!0,ht=c(B.x+B.width/2,B.x+B.width))),mt?(V.y+=Tt,Y.y+=Tt,V.y>=gt&&(mt=!1,gt=c(B.y,B.y+B.height/2))):(V.y-=Tt,Y.y-=Tt,V.y<=gt&&(mt=!0,gt=c(B.y+B.height/2,B.y+B.height)));var e=$.width*$.scaleX,t=$.width,i=$.x-(e-t)/2,n=$.height*$.scaleY,a=$.height,r=$.y-(n-a)/2,s={center_x:i+$.width*$.scaleX/2,center_y:r+$.height*$.scaleY/2};if(s.center_x>=o("x",5)&&s.center_x<=o("x",15)&&!It){if(It=!0,S.play(),$.stop(),w.stop(),$.clearTransforms(),L=0,q.x>=v.x_left&&q.x<=v.x_right)if(q.x>B.x+B.width*B.scaleX/2){var d=B.x+B.width*B.scaleX/2,l=B.x+B.width*B.scaleX,u=q.x,h=l-d,f=u-d,m=f/h*100/2;L+=50-Math.round(m)}else{var d=B.x,l=B.x+B.width*B.scaleX/2,u=q.x,h=l-d,f=u-d,m=f/h*100/2;L+=Math.round(m)}if(V.y>=E.y_top&&V.y<=E.y_bottom)if(V.y>B.y+B.height*B.scaleY/2){var d=B.y+B.height*B.scaleY/2,l=B.y+B.height*B.scaleY,u=V.y,h=l-d,f=u-d,m=f/h*100/2;L+=50-Math.round(m)}else{var d=B.y,l=B.y+B.height*B.scaleY/2,u=q.y,h=l-d,f=u-d,m=f/h*100/2;L+=Math.round(m)}"ON"==p&&R.play(),yt.text="You have earned "+L+" more points.\nGet ready for the next shot.",q.hide(),V.hide(),B.hide(),j.hide(),W.hide(),Q.hide(),H.hide(),setTimeout(function(){yt.visible=!0,Ut.visible=!0,z.text="Total points : "+(y+=L),$.hide(),setTimeout(function(){g&&(yt.visible=!1,Ut.visible=!1,rt())},3e3)},3e3)}It||vt()}},100)};h.addEventListener("close",function(){g=!1,b.stop(),w.stop()}),h.addEventListener("open",function(){if("android"===u){var e=h.activity;e.addEventListener("resume",function(){}),e.addEventListener("pause",function(){g=!1,b.stop(),w.stop()}),e.addEventListener("destroy",function(){})}}),I.addEventListener("click",function(){});var Et=Ti.UI.createLabel({text:"somelabel",visible:!1,color:"#000000",font:{fontSize:"14dp"},top:0,textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,zIndex:500});h.add(Et);var _t=!1,bt=!1,Rt=!1,xt=!1,At=!1;I.addEventListener("touchstart",function(e){var t=I.screen.width,i=I.screen.height,n=Titanium.Platform.displayCaps.platformWidth,a=Titanium.Platform.displayCaps.platformHeight;t>n?(e.x=t/n*e.x,e.y=i/a*e.y):(e.x=n/t*e.x,e.y=a/i*e.y),_t=!1;var o={x:e.x,y:e.y},r={left:H.x,top:H.y,width:H.width,height:H.height},s={left:j.x,top:j.y,width:j.width,height:j.height},d={left:W.x,top:W.y,width:W.width,height:W.height},c={left:Q.x,top:Q.y,width:Q.width,height:Q.height};return St(o,r)?(bt=!0,H.x+=5,H.y+=5,V.y-=6*Tt,Y.y-=6*Tt,void 0):St(o,s)?(j.x+=5,j.y+=5,Rt=!0,V.y+=6*Tt,Y.y+=6*Tt,void 0):St(o,d)?(W.x+=5,W.y+=5,xt=!0,q.x-=6*Tt,Y.x-=6*Tt,void 0):St(o,c)?(Q.x+=5,Q.y+=5,At=!0,q.x+=6*Tt,Y.x+=6*Tt,void 0):void 0}),I.addEventListener("touchmove",function(){}),I.addEventListener("touchend",function(){bt&&(H.x-=5,H.y-=5,bt=!1),Rt&&(j.x-=5,j.y-=5,Rt=!1),xt&&(W.x-=5,W.y-=5,xt=!1),At&&(Q.x-=5,Q.y-=5,At=!1)});var wt=require("/ui/common/games/JoustingKnightSkinParams"),St=(new wt,function(e,t){return e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height?!0:!1}),Ut=Ti.UI.createImageView({image:"/assets/games/scroll.png",width:o("x","50"),height:s(o("x","50"),1.3),visible:!1,top:"10%",zIndex:900});h.add(Ut);var yt=Ti.UI.createLabel({color:"#000000",font:{fontSize:"12dip",fontWeight:"bold"},textAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,left:o("x","30"),top:"15%",visible:!1,width:o("x","40"),height:s(o("x","40"),1.3),zIndex:950});h.add(yt);var Lt=Ti.UI.createButton({color:"#761f56",title:"Ok",color:"#000000",textAlign:"center",bottom:"10%",height:"20%",width:"33%",visible:!1,left:"33%",backgroundImage:"/assets/button_small_UP.png"});return Lt.addEventListener("click",function(){}),h.add(Lt),I.addEventListener("onloadsprite",function(){pt++,pt>=ut.length-1&&(b.play(),b.setLooping(!0),rt())}),h.add(I),h.open({fullscreen:!0,navBarHidden:!0}),h}module.exports=JoustinGamePlay;