function MyQuest(e,t){function i(){Ti.App.removeEventListener("clear_quest_intervals",i),clearInterval(s),s=null;var e="";for(var t in R)R.hasOwnProperty(t)&&(e+=t+"::",void 0!=R[t]&&R[t].stop())}var n,o,a,r=Titanium.Platform.displayCaps.platformWidth,s=(Titanium.UI.createImageView({image:"/assets/male_icon.png"}),Titanium.UI.createImageView({image:"/assets/female_icon.png"}),0),d="",c=[],l=0,u=[],p=require("/ui/common/drawings/AvatarThumbnail"),h=function(e,t,i,n,o,a){return{total_sec:60*e*60+60*t+i,timer:this.timer,instance_index:n,set:function(e,t,i){return this.total_sec=60*parseInt(e)*60+60*parseInt(t)+parseInt(i),this.time={h:e,m:t,s:i},this},start:function(){var e=this;return this.timer=setInterval(function(){if(e.total_sec){e.total_sec--;var t=parseInt(e.total_sec/3600),i=(e.total_sec-parseInt(3600*t)-e.total_sec%60)/60;e.time={h:parseInt(e.total_sec/3600),m:parseInt(i),s:e.total_sec%60},o(e.time.h+":"+e.time.m+":"+e.time.s,e.instance_index)}else e.stop(),a(e.instance_index)},1e3),this},stop:function(){return clearInterval(this.timer),this.time={h:0,m:0,s:0},this.total_sec=0,this}}},g=.2*r,m="",f=0,T="",I=[],v=!0,_=Ti.UI.createTableView({backgroundColor:"transparent",separatorColor:"transparent",width:"100%",height:"100%",top:0}),E={},R=[],b=[],S=[],A=[],x=[],U=require("/ui/common/Functions/function");U.requestServer({success:function(){if(m=JSON.parse(this.responseText),f=m.Record.length,void 0!=m.Record){for(var i="",r=0;r<m.Record.length;r++){v=!1,i="/assets/freind_list"+("f"==m.Record[r].GENDER?"_female":"_male")+".png",E[m.Record[r].ASSIGN_QUEST_ID]=m.Record[r].STATUS,u[l]=Ti.UI.createTableViewRow({className:"my_quests",index:r,height:g,backgroundImage:"/assets/quest_row_bg.png"}),u[l].addEventListener("longpress",function(e){Titanium.Media.vibrate();var t=require("/ui/common/MenuScreen/RemoveQuest"),i=new t(m.Record[e.index].ASSIGN_QUEST_ID,e.index,"ASSIGNEE");i.open({modal:!0})});var s=Ti.UI.createLabel({text:m.Record[r].NAME,top:"10%",font:{fontSize:"18dip",fontWeight:"bold"},color:"#5afd9b",left:"18%",width:"45%"});u[l].add(s);var d=Ti.UI.createLabel({text:"LVL "+m.Record[r].LEVEL,top:"38%",font:{fontSize:"12dip"},color:"#5afd9b",left:"18%",width:"45%"});u[l].add(d),p({width:"13%",top:"2px",left:"5px"},m.Record[r].USER_APPEARANCE,m.Record[r].GENDER,l,function(e,t){x[t]=e,u[t].add(x[t])});{Ti.UI.createLabel({color:"#5afd9b",font:{fontSize:"14dip"},top:35*g/100,left:"38%",textAlign:"center",text:m.Record[r].NUM_OF_FRIENDS})}if("EXPIRE"==m.Record[r].STATUS||"COMPLETE"==m.Record[r].STATUS){n=Ti.UI.createLabel({text:"COMPLETE"==m.Record[r].STATUS?"Completed":"Time Expired",top:"35%",color:"#5afd9b",font:{fontSize:"12dip"},right:g/3,textAlign:"right"}),u[l].add(n);var c=Ti.UI.createImageView({image:"COMPLETE"==m.Record[r].STATUS?"/assets/check_icon.png":"/assets/cross_icon.png",top:"30%",right:"5px",height:g/3.5,width:g/3.5});u[l].add(c)}else if(A[m.Record[r].ASSIGN_QUEST_ID]=Ti.UI.createButton({color:"#761f56",title:"CHOOSE QUEST",height:g/3,top:"50%",width:1.75*g,font:{fontSize:"12dip"},opacity:100,right:"5px",backgroundColor:"#C977A5",borderColor:"#A62C77",borderRadius:5,borderWidth:1,friend_uid:m.Record[r].ASSIGN_BY_UID,is_completed:m.Record[r].STATUS,friend_quest_info:m.Record[r]}),A[m.Record[r].ASSIGN_QUEST_ID].addEventListener("click",function(t){var i=require("/ui/common/MenuScreen/FriendQuest"),n=i(e,t.source.friend_uid,t.source.friend_quest_info,t.source.is_completed);n.open()}),u[l].add(A[m.Record[r].ASSIGN_QUEST_ID]),S[m.Record[r].ASSIGN_QUEST_ID]=Ti.UI.createImageView({image:"/assets/alarm_clock_icon.png",top:"10%",right:"5px",height:g/3.5,width:g/3.5}),u[l].add(S[m.Record[r].ASSIGN_QUEST_ID]),b[m.Record[r].ASSIGN_QUEST_ID]=Ti.UI.createLabel({text:m.Record[r].EXPIRED_TIME,complete:!0,top:"12%",color:"#5afd9b",font:{fontSize:"12dip"},right:g/3,textAlign:"right"}),u[l].add(b[m.Record[r].ASSIGN_QUEST_ID]),"COMPLETE"!=m.Record[r].STATUS&&"EXPIRE"!=m.Record[r].STATUS){T+=m.Record[r].ASSIGN_QUEST_ID+":";var U=m.Record[r].EXPIRED_TIME.split(":");R[m.Record[r].ASSIGN_QUEST_ID]=new h(parseInt(U[0]),parseInt(U[1]),parseInt(U[2]),m.Record[r].ASSIGN_QUEST_ID,function(e,t){b[t].text=e},function(e){S[e].image="/assets/cross_icon.png",b[e].text="Time Expired",A[e].animate(Ti.UI.createAnimation({opacity:0,duration:500}),function(){S[e].animate(Ti.UI.createAnimation({top:g/3.5,duration:500})),b[e].animate(Ti.UI.createAnimation({top:g/3,duration:500}))})}),R[m.Record[r].ASSIGN_QUEST_ID].start()}o=Ti.UI.createLabel({text:"Rewards:",color:"#5afd9b",font:{fontSize:"12dip"},bottom:10*g/100,right:"35%",textAlign:"center"}),a=Ti.UI.createLabel({text:m.Record[r].NUM_OF_QUESTS+" Quest(s)",color:"#5afd9b",font:{fontSize:"12dip",fontWeight:"bold"},bottom:"8%",left:"18%",textAlign:"center"}),u[l].add(a),I.push(u[l]),l++}_.data=I;var w=Ti.UI.createView({backgroundColor:"transparent",separatorColor:"transparent",width:"100%",height:"100%",top:"2%"});w.add(_);var y=Ti.UI.createLabel({text:"You have no Quests!",font:{fontWeight:"bold",fontSize:"18dip"},color:"#b3fad0"});w.add(y),y.hide(),v&&y.show(),t(w)}},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/knp_get_my_quests.php?uid="+e.Record[0].UID}),Ti.App.addEventListener("remove_my_quest",function(e){_.deleteRow(e.index)});Ti.App.addEventListener("clear_quest_intervals",i);var w=!1;s=setInterval(function(){d="";for(var i in E)E.hasOwnProperty(i)&&(d+=i+":"+E[i]+",");var r="http://bonozo.com:8080/knp/check_quest_status.php?uid="+e.Record[0].UID+"&assign_quest_id="+d;w||(w=!0),Ti.API.info(r);var s=require("/ui/common/Functions/function");s.requestServer({success:function(){if(update_items_json=JSON.parse(this.responseText),Ti.API.info(JSON.stringify(update_items_json)),void 0!=update_items_json.Record){if(update_items_json.Record.NEW.length>0){v&&empty_quest_label.hide(),Ti.App.fireEvent("NEW_QUEST",{status:"NEW"});for(var i="",r=0;r<update_items_json.Record.NEW.length;r++){i="/assets/freind_list"+("f"==m.Record[r].GENDER?"_female":"_male")+".png",E[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]=update_items_json.Record.NEW[r].STATUS,u[l]=Ti.UI.createTableViewRow({index:r,height:g,backgroundImage:"/assets/quest_row_bg.png",className:"my_quests"});var s=Ti.UI.createLabel({text:update_items_json.Record.NEW[r].NAME,top:"10%",font:{fontSize:"18dip",fontWeight:"bold"},color:"#5afd9b",left:"18%",width:"45%"});u[l].add(s);var d=Ti.UI.createLabel({text:"LVL "+update_items_json.Record.NEW[r].LEVEL,top:"38%",font:{fontSize:"12dip"},color:"#5afd9b",left:"18%",width:"45%"});u[l].add(d);var p=require("/ui/common/drawings/AvatarThumbnail");p({width:"13%",top:"2px",left:"5px"},update_items_json.Record.NEW[r].USER_APPEARANCE,update_items_json.Record.NEW[r].GENDER,l,function(e,t){u[t].add(e)});{Ti.UI.createLabel({color:"#5afd9b",font:{fontSize:"14dip"},top:35*g/100,left:"38%",textAlign:"center",text:update_items_json.Record.NEW[r].NUM_OF_FRIENDS})}if("EXPIRE"==update_items_json.Record.NEW[r].STATUS){n=Ti.UI.createLabel({text:"Time Expired",top:"35%",color:"#5afd9b",font:{fontSize:"12dip"},right:g/3,textAlign:"right"}),u[l].add(n);var f=Ti.UI.createImageView({image:"/assets/cross_icon.png",top:"30%",right:"5px",height:g/3.5,width:g/3.5});u[l].add(f)}else if(A[m.Record[r].ASSIGN_QUEST_ID]=Ti.UI.createButton({color:"#761f56",title:"CHOOSE QUEST",width:1.75*g,height:g/3,top:"50%",font:{fontSize:"12dip"},right:"5px",backgroundColor:"#C977A5",borderColor:"#A62C77",borderRadius:5,borderWidth:1,friend_uid:update_items_json.Record.NEW[r].ASSIGN_BY_UID,is_completed:update_items_json.Record.NEW[r].STATUS,friend_quest_info:update_items_json.Record.NEW[r]}),A[m.Record[r].ASSIGN_QUEST_ID].addEventListener("click",function(t){var i=require("/ui/common/MenuScreen/FriendQuest"),n=i(e,t.source.friend_uid,t.source.friend_quest_info,t.source.is_completed);n.open()}),u[l].add(A[m.Record[r].ASSIGN_QUEST_ID]),S[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]=Ti.UI.createImageView({image:"COMPLETE"!=m.Record[r].STATUS?"/assets/alarm_clock_icon.png":"/assets/check_icon.png",top:"10%",right:"5px",height:g/3.5,width:g/3.5}),u[l].add(S[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]),b[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]=Ti.UI.createLabel({text:"COMPLETE"!=update_items_json.Record.NEW[r].STATUS?update_items_json.Record.NEW[r].REMAINING_TIME:"",complete:!0,top:"12%",color:"#5afd9b",font:{fontSize:"12dip"},right:g/3,textAlign:"right"}),u[l].add(b[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]),"COMPLETE"!=update_items_json.Record.NEW[r].STATUS){var T=update_items_json.Record.NEW[r].REMAINING_TIME.split(":");R[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID]=new h(parseInt(T[0]),parseInt(T[1]),parseInt(T[2]),update_items_json.Record.NEW[r].ASSIGN_QUEST_ID,function(e,t){b[t].text=e},function(e){S[e].image="/assets/cross_icon.png",b[e].text="Time Expired",A[e].animate(Ti.UI.createAnimation({opacity:0,duration:500}),function(){S[e].animate(Ti.UI.createAnimation({top:g/3.5,duration:500})),b[e].animate(Ti.UI.createAnimation({top:g/3,duration:500}))})}),R[update_items_json.Record.NEW[r].ASSIGN_QUEST_ID].start()}o=Ti.UI.createLabel({text:"Rewards:",color:"#5afd9b",font:{fontSize:"12dip"},bottom:10*g/100,right:"35%",textAlign:"center"}),a=Ti.UI.createLabel({text:update_items_json.Record.NEW[r].NUM_OF_QUESTS+" Quest(s)",color:"#5afd9b",font:{fontSize:"12dip",fontWeight:"bold"},bottom:"8%",left:"18%",textAlign:"center"}),u[l].add(a),I.push(u[l]),l++}_.data=I,t(_)}if(""!=update_items_json.Record.UPDATE){for(var x in update_items_json.Record.UPDATE)update_items_json.Record.UPDATE.hasOwnProperty(x)&&(E[x]==x&&(E[x]=update_items_json.Record.UPDATE[x]),S[x].image="COMPLETE"==update_items_json.Record.UPDATE[x]?"/assets/check_icon.png":"/assets/cross_icon.png",b[x].text="COMPLETE"==update_items_json.Record.UPDATE[x]?"Completed":"Expired",A[x].animate(Ti.UI.createAnimation({opacity:0,duration:500}),function(){S[x].animate(Ti.UI.createAnimation({top:g/3.5,duration:500})),b[x].animate(Ti.UI.createAnimation({top:g/3,duration:500}))}),R[x].stop());var U="";for(var x in c)c.hasOwnProperty(x)&&(U+=x+":"+c[x]+"\n")}}},method:"GET",contentType:"text/xml",url:r})},6e3)}module.exports=MyQuest;