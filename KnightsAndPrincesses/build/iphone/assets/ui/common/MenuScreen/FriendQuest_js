function FriendQuest(e,t,i,n){function a(e,t){var i=Ti.UI.createView({zIndex:1}),n=require("/ui/common/drawings/Avatar"),a=require("/ui/common/drawings/Settings"),o=new a,r={};if(r.gender=e.Record[0].GENDER,r.main_view={width:1.5*o.avatar_width,height:1.5*o.avatar_height,right:"0%",top:"8%",zIndex:1},void 0!=e.Record&&""!=e.Record[0].USER_APPEARANCE&&"f"==e.Record[0].GENDER){r.appearence={hair_back:"/assets/princess/"+e.Record[0].USER_APPEARANCE[0].IMAGE+"-back.png",face:"/assets/princess/"+e.Record[0].USER_APPEARANCE[1].IMAGE+".png",dress:"/assets/princess/"+e.Record[0].USER_APPEARANCE[3].IMAGE+".png",hair_front:"/assets/princess/"+e.Record[0].USER_APPEARANCE[0].IMAGE+"-front.png",jewelery:"/assets/princess/"+e.Record[0].USER_APPEARANCE[2].IMAGE+".png"};var d=new n(r);i.add(d),t(i)}else if(void 0!=e.Record&&""!=e.Record[0].USER_APPEARANCE&&"m"==e.Record[0].GENDER){r.appearence={dress:"/assets/knight/"+e.Record[0].USER_APPEARANCE[2].IMAGE+".png",helmet:"/assets/knight/"+e.Record[0].USER_APPEARANCE[4].IMAGE+".png",shield:"/assets/knight/"+e.Record[0].USER_APPEARANCE[5].IMAGE+".png",hair_back:"/assets/knight/"+e.Record[0].USER_APPEARANCE[0].IMAGE+"-back.png",face:"/assets/knight/"+e.Record[0].USER_APPEARANCE[1].IMAGE+".png",hair_front:"/assets/knight/"+e.Record[0].USER_APPEARANCE[0].IMAGE+"-front.png",weapon:"/assets/knight/"+e.Record[0].USER_APPEARANCE[3].IMAGE+".png"};var d=new n(r);i.add(d),t(i)}else if("f"==e.Record[0].GENDER){var s=require("/ui/common/drawings/Defaults");new s("f",function(e){r.appearence={hair_back:"/assets/princess/"+e.hair.IMAGE+"-back.png",face:"/assets/princess/"+e.face.IMAGE+".png",dress:"/assets/princess/"+e.dress.IMAGE+".png",hair_front:"/assets/princess/"+e.hair.IMAGE+"-front.png",jewelery:"/assets/princess/"+e.jwelery.IMAGE+".png"};var a=new n(r);i.add(a),t(i)})}else{var s=require("/ui/common/drawings/Defaults");new s("m",function(e){r.appearence={dress:"/assets/knight/"+e.dress.IMAGE+".png",helmet:"/assets/knight/"+e.helmet.IMAGE+".png",shield:"/assets/knight/"+e.shield.IMAGE+".png",hair_back:"/assets/knight/"+e.hair.IMAGE+"-back.png",face:"/assets/knight/"+e.face.IMAGE+".png",hair_front:"/assets/knight/"+e.hair.IMAGE+"-front.png",weapon:"/assets/knight/"+e.weapons.IMAGE+".png"};var a=new n(r);i.add(a),t(i)})}}function o(e,t){return"x"==e?s*t/100:"y"==e?c*t/100:void 0}function r(){u.requestServer({success:function(){for(var t=JSON.parse(this.responseText),n=0;n<t.Record.length;n++){var a=Titanium.UI.createTableViewRow({height:1.5*U+"px",backgroundImage:"/assets/quest_row_bg.png",zIndex:400});a.addEventListener("longpress",function(e){Titanium.Media.vibrate();var i=require("/ui/common/MenuScreen/RemoveQuest"),n=new i(t.Record[e.index].ASSIGN_QUEST_ID,e.index,"ASSIGNER");n.open({modal:!0})});var o=Ti.UI.createImageView({image:"/assets/"+t.Record[n].QUEST_NAME+".png",height:"80%",zIndex:500,left:"10%"});if(a.add(o),"COMPLETE"==t.Record[n].STATUS){var r=Ti.UI.createLabel({text:"Completed",color:"#5AFD9B",font:{fontSize:"16dip"},zIndex:500,left:"30%"});a.add(r)}else if("EXPIRED"==t.Record[n].STATUS){var r=Ti.UI.createLabel({text:"Expired",color:"#5AFD9B",zIndex:500,font:{fontSize:"16dip"},left:"30%"});a.add(r)}else{var s=Ti.UI.createButton({color:"#761f56",backgroundImage:"/assets/button_small_UP.png",right:"10%",zIndex:500,width:"40%",height:"70%",title:"Start Quest",font:{fontSize:"12dip"},quest_image:t.Record[n].QUEST_IMAGE,assign_quest_id:t.Record[n].ASSIGN_QUEST_ID,quest_id:t.Record[n].QUEST_ID});s.addEventListener("click",function(t){{var n=require("/ui/common/MenuScreen/MultiPlayerGame");new n(e,t.source.quest_image,i.ASSIGN_QUEST_ID)}}),a.add(s)}A.push(a)}d=Ti.UI.createTableView({backgroundColor:"transparent",separatorColor:"transparent",data:A,width:"70%",height:"40%",left:"0",top:"45%",zIndex:400}),f.add(d)},onerror:function(e){Ti.API.debug("STATUS: "+this.status),Ti.API.debug("TEXT: "+this.responseText),Ti.API.debug("ERROR: "+e.error),Ti.API.debug("URL: http://bonozo.com:8080/knp/get_all_assigned_quests.php?assign_by=10000002&assign_to=10000001"),alert("There was an error retrieving the remote data. Try again.")},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/knp_get_friend_quest_games.php?assign_quest_id="+i.ASSIGN_QUEST_ID})}var d,s=Titanium.Platform.displayCaps.platformWidth,c=Titanium.Platform.displayCaps.platformHeight,l="",u=require("/ui/common/Functions/function"),p=Ti.UI.createWindow({orientation:Ti.UI.PORTRAIT,navBarHidden:!0,fullscreen:!0});p.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];var f=Titanium.UI.createView({width:"100%",height:"100%",backgroundImage:"/assets/inventoryBackground.png"});p.add(f);var g=Titanium.UI.createView({backgroundColor:"#FFFFFF",borderRadius:10,borderColor:"#333333",borderWidth:"5dip",left:o("x",50)-s/4,top:o("x",42),visible:!1,height:"8%",width:s/2,zIndex:700}),m=Ti.UI.createActivityIndicator({color:"#333333",font:{fontSize:"14dip",fontWeight:"bold"},message:"Loading...",style:"iPhone OS"===Ti.Platform.name?Ti.UI.iPhone.ActivityIndicatorStyle.DARK:Ti.UI.ActivityIndicatorStyle.DARK,height:"100%",width:"100%"});g.add(m),p.add(g),function(){m.show(),g.visible=!0,m.message="Loading..."}();var h=function(e,t,i,n,a){return{total_sec:60*e*60+60*t+i,timer:this.timer,set:function(e,t,i){return this.total_sec=60*parseInt(e)*60+60*parseInt(t)+parseInt(i),this.time={h:e,m:t,s:i},this},start:function(){var e=this;return this.timer=setInterval(function(){if(e.total_sec){e.total_sec--;var t=parseInt(e.total_sec/3600),i=(e.total_sec-parseInt(3600*t)-e.total_sec%60)/60;e.time={h:parseInt(e.total_sec/3600),m:parseInt(i),s:e.total_sec%60},n(e.time.h+":"+e.time.m+":"+e.time.s,e.instance_index)}else e.stop(),a()},1e3),this},stop:function(){return clearInterval(this.timer),this.time={h:0,m:0,s:0},this.total_sec=0,this}}},T=Titanium.UI.createImageView({image:"/assets/overlayPlayerInfoCroped.png",height:"6.4%",width:"100%",bottom:"94.6%",zIndex:100});f.add(T);var I=Titanium.UI.createLabel({text:"Assigned Quest",top:"1.75%",height:"3.1%",left:"3%",textAlign:"right",color:"#5afd9b",font:{fontSize:"12dip"},zIndex:200});f.add(I);var v=Titanium.UI.createLabel({text:"Back",top:"1.75%",height:"3.1%",right:"15.6%",textAlign:"right",color:"#5afd9b",font:{fontSize:"12dip"},zIndex:200});f.add(v);var E=Titanium.UI.createLabel({top:"7%",height:"3.5%",text:"Some Name",left:"3%",textAlign:"left",color:"#5afd9b",font:{fontWeight:"bold",fontSize:"16dip"},zIndex:500});f.add(E);var _=Titanium.UI.createLabel({top:"10.1%",left:"4%",textAlign:"left",color:"#5afd9b",font:{fontSize:"10dip"},zIndex:50});f.add(_);var b=Ti.UI.createButton({color:"#761f56",backgroundImage:"/assets/button_small_UP.png",top:"10%",right:"10%",width:"21.5%",height:"5%",title:"Messages",zIndex:510,font:{fontSize:"10dip"},zIndex:50}),R=Titanium.UI.createImageView({image:"/assets/iconReturn.png",width:"11.6%",top:"1%",right:"3%",zIndex:300});f.add(R),R.addEventListener("click",function(){n||l.stop(),p.close()});var A=[],S=Titanium.Platform.displayCaps.platformHeight,U=.12*S;Ti.App.addEventListener("remove_friend_quest",function(e){d.deleteRow(e.index)}),r(),Ti.App.addEventListener("game_played",function(){f.remove(d),A=[],d=null,r()}),u.requestServer({success:function(){var t=JSON.parse(this.responseText);_.text=t.Record[0].STATUS_MESSAGE+" \nLVL "+t.Record[0].LEVEL,E.text=t.Record[0].NAME,x.text=t.Record[0].NUM_OF_GOLDS,f.add(b),b.addEventListener("click",function(){var i=require("/ui/common/MenuScreen/MessageScreen"),n=new i(e,"","","",t);n.open({modal:!0})}),a(t,function(e){f.add(e),m.hide(),g.visible=!1})},onerror:function(e){Ti.API.debug("STATUS: "+this.status),Ti.API.debug("TEXT: "+this.responseText),Ti.API.debug("ERROR: "+e.error),Ti.API.debug("URL: http://bonozo.com:8080/knp/get_avatar_info.php?uid="+t),alert("There was an error retrieving the remote data. Try again.")},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/get_avatar_info.php?uid="+t});var _=Titanium.UI.createLabel({top:"10.1%",left:"4%",textAlign:"left",color:"#5AFD9B",font:{fontSize:"10dip"}});f.add(_);var w=Titanium.UI.createImageView({image:"/assets/iconGoldMini.png",width:"7%",top:"15.5%",left:"3%"});f.add(w);var x=Titanium.UI.createLabel({top:"15.5%",left:"12.5%",textAlign:"left",color:"#FFCC00",font:{fontWeight:"bold",fontSize:"12dip"}});f.add(x);var L=Ti.UI.createView({backgroundImage:"/assets/quest_row_bg.png",width:"70%",height:2*U+"px",top:"30%",left:0,zIndex:450});f.add(L);var k=Titanium.UI.createLabel({color:"#5afd9b",zIndex:500});L.add(k);var N="http://bonozo.com:8080/knp/knp_get_friend_quest_games.php?assign_quest_id="+i.ASSIGN_QUEST_ID,u=require("/ui/common/Functions/function");u.requestServer({success:function(){if(Ti.App.fireEvent("update_footer",{clicked_item:"FreindQuest"}),items_json=JSON.parse(this.responseText),void 0!=items_json.Record&&items_json.Record.length>0)if("COMPLETE"==n)k.text="QUESTS COMPLETED!";else{var e=items_json.Record[0].EXPIRED_TIME.split(":");l=new h(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),function(){k.text="Time remaining: "+l.time.h+":"+l.time.m+":"+l.time.s},function(){}),l.start()}},method:"GET",contentType:"text/xml",url:N});var y=(Titanium.UI.createImageView({url:"/assets/iconReturn.png",height:"5.2%",top:"19.8%",left:"41.3%"}),require("ui/common/menus/Footer")),P=new y(e);return f.add(P),f.addEventListener("android:back",function(){l.stop(),activity.finish()}),p}module.exports=FriendQuest;