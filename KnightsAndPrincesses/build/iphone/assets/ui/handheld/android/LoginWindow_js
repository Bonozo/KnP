function LoginWindow(){function e(e){e(!0,Titanium.Platform.id)}function t(e,t,i){T.Users.login({login:e,password:t},function(e){if(e.success){var t=e.users[0];i(!0,t.id)}else i(!1,e.message)})}function i(e){T.Users.logout(function(t){t.success?e(!0,"Successfully logout"):e(!1,t.message)})}function n(e,t,i,n,a){T.Users.create({email:e,username:e,password:n,password_confirmation:n},function(e){if(e.success){var t=e.users[0];a(!0,t.id)}else a(!1,e.message)})}function a(e,t){T.Users.query({page:1,per_page:10,where:{email:e}},function(e){e.success?e.users.length>0?t(!0,e.users[0].id):t(!0,""):t(!1,e.message)})}function o(e,i,o,r){h?a(e,function(t,a){""==a?n(e,"","","test",function(e,t){e?T.PushNotifications.subscribe({channel:i,device_token:o,user_id:t,type:"android"},function(e){e.success?r(!0,t):r(!1,e.message)}):r(!1,t)}):T.PushNotifications.subscribe({channel:i,device_token:o,user_id:a,type:"android"},function(e){e.success?r(!0,a):r(!1,e.message)})}):t("admin@bonozo.com","admin",function(t,s){t?(h=!0,a(e,function(t,a){""==a?n(e,"","","test",function(e,t){e?T.PushNotifications.subscribe({channel:i,device_token:o,user_id:t,type:"android"},function(e){e.success?r(!0,t):r(!1,e.message)}):alert("131: created_uid="+t)}):T.PushNotifications.subscribe({channel:i,device_token:o,user_id:a,type:"android"},function(e){e.success?r(!0,a):r(!1,e.message)})})):r(!1,s)})}function r(e,i,n,a){h?T.PushNotifications.unsubscribe({channel:i,device_token:n,user_id:e},function(e){e.success?a(!0,"Successfully unsubscribed"):a(!1,e.message)}):t("admin@bonozo.com","admin",function(){h=!0,T.PushNotifications.unsubscribe({device_token:n,channel:i,user_id:e},function(e){e.success?a(!0,"Successfully unsubscribed"):a(!1,e.message)})})}function s(e,t,i,n,a){var o=require("/ui/common/Functions/function");Ti.API.info("http://bonozo.com:8080/knp/?email="+e+"&password="+t+"&version="+n+"&device_token="+i),o.requestServer({success:function(){var e=JSON.parse(this.responseText);void 0!=e.Record?(g&&(Ti.App.Properties.setBool("signed_in",!0),Ti.App.Properties.setString("knp_email",y.value),Ti.App.Properties.setString("knp_password",L.value),Ti.App.Properties.setString("knp_sound",null==Ti.App.Properties.getString("knp_sound")?"ON":"OFF")),"iPhone OS"===Ti.Platform.name&&(Ti.App.Properties.setBool("signed_in",!0),Ti.App.Properties.setString("knp_email",y.value),Ti.App.Properties.setString("knp_password",L.value)),a(!0,e.Record)):void 0!=e.Error&&(void 0!=e.Error.AuthException?a(!1,e.Error.AuthException):e.Error.Request?a(!1,e.Error.Request):a(!1,"Unknown error occured!"))},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/?email="+e+"&password="+t+"&version="+n+"&device_token="+i})}function d(e,t,i,n){var a=require("/ui/common/Functions/function");a.requestServer({success:function(){var e=JSON.parse(this.responseText);void 0!=e.Record[0]?(g&&(Ti.App.Properties.setBool("signed_in",!0),Ti.App.Properties.setString("knp_email",y.value),Ti.App.Properties.setString("knp_password",L.value),Ti.App.Properties.getString("knp_sound")||Ti.App.Properties.setString("sound","ON")),n(!0,e.Record[0])):void 0!=e.Error&&(void 0!=e.Error.AuthException?n(!1,e.Error.AuthException):e.Error.Request?n(!1,e.Error.Request):n(!1,"Unknown error occured!"))},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/insert_uid_token.php?email="+e+"&uid="+t+"&token="+i})}function c(e,t){return"x"==e?_*t/100:"y"==e?E*t/100:void 0}function l(t,n){""==t.value&&""==n.value?alert("All fields are required!"):(I.show(),R.show(),R.message="Signing in...",b.visible=!0,t.value=t.value.toLowerCase(),e(function(e,c){e?s(t.value,n.value,c,"0.4.01",function(e,n){if(!e)return I.hide(),R.hide(),R.message="Signing in...",b.visible=!1,alert(n),void 0;if("iphone"!==p&&"ipad"!==p)if(e)if("NULL"==n[0].LAST_USER)o(t.value,"alert",c,function(e,a){e?d(t.value,a,c,function(e,t){e?i(function(){if(n={Record:n},rec=n,"r"==n.Record[0].GENDER){var e=require("/ui/common/MenuScreen/ResetClass"),t=new e(n);t.open(),t.addEventListener("open",function(){R.hide(),b.visible=!1})}else{var i=require("/ui/common/MenuScreen/MainMenuScreen");MainMenu=new i(n),MainMenu.open(),MainMenu.addEventListener("open",function(){R.hide(),b.visible=!1})}}):alert("565:"+t)}):alert("569:"+a)});else if("ME"==n[0].LAST_USER)if(n={Record:n},"r"==n.Record[0].GENDER){var s=require("/ui/common/MenuScreen/ResetClass"),l=new s(n);l.open(),l.addEventListener("open",function(){R.hide(),b.visible=!1})}else{var u=require("/ui/common/MenuScreen/MainMenuScreen");MainMenu=new u(n),MainMenu.open(),MainMenu.addEventListener("open",function(){R.hide(),b.visible=!1})}else"OTHER"==n[0].LAST_USER?a(n[0].EMAIL,function(e,i){e?r(i,"alert",n[0].DEVICE_TOKEN,function(){o(t.value,"alert",c,function(e,i){d(t.value,i,c,function(e,t){if(e)if(n={Record:n},"r"==n.Record[0].GENDER){var i=require("/ui/common/MenuScreen/ResetClass"),a=new i(n);a.open(),a.addEventListener("open",function(){R.hide(),b.visible=!1})}else{var o=require("/ui/common/MenuScreen/MainMenuScreen");MainMenu=new o(n),MainMenu.open(),MainMenu.addEventListener("open",function(){R.hide(),b.visible=!1})}else alert("629:"+t)})})}):alert("635:"+i)}):a(n[0].LAST_USER,function(e,i){var a=n[0].LAST_USER;r(i,"alert",c,function(){o(t.value,"alert",c,function(e,i){d(t.value,i,c,function(e,t){e?(n={Record:n},d(a,"","",function(e,t){if(e)if("r"==n.Record[0].GENDER){var i=require("/ui/common/MenuScreen/ResetClass"),a=new i(n);a.open(),a.addEventListener("open",function(){R.hide(),b.visible=!1})}else{var o=require("/ui/common/MenuScreen/MainMenuScreen");MainMenu=new o(n),MainMenu.open(),MainMenu.addEventListener("open",function(){R.hide(),b.visible=!1})}else alert("677:"+t)})):alert("681"+t)})})})});else alert("693:"+n),R.hide(),b.visible=!1;else if(Ti.App.Properties.setString("uid",n[0].UID),"r"==n[0].GENDER){n={Record:n};var s=require("/ui/common/MenuScreen/ResetClass"),l=new s(n);l.open(),l.addEventListener("open",function(){R.hide(),b.visible=!1})}else{n={Record:n};var u=require("/ui/common/MenuScreen/MainMenuScreen");MainMenu=new u(n),MainMenu.open(),MainMenu.addEventListener("open",function(){R.hide(),b.visible=!1})}}):(alert("700:"+c),R.hide(),b.visible=!1)}))}Ti.App.Properties.setBool("internet_error",!1);var u,p=Ti.Platform.osname,h=!1,g=!1,m=0;if(m=Titanium.App.Properties.getString("viewstack"),0==m&&Titanium.App.Properties.setString("viewstack",0),"android"===p){var f=require("ti.cloudpush");f.debug=!0,f.enabled=!0,f.showTrayNotificationsWhenFocused=!0,f.focusAppOnPush=!1;var T=require("ti.cloud");T.debug=!0}var v=Ti.UI.createWindow({fullscreen:!0,navBarHidden:!0});v.orientationModes=[Ti.UI.PORTRAIT,Ti.UI.UPSIDE_PORTRAIT];var I=Titanium.UI.createActivityIndicator({color:"#333333",zIndex:600});I.message="Signing In...";var _=Titanium.Platform.displayCaps.platformWidth,E=Titanium.Platform.displayCaps.platformHeight,b=Titanium.UI.createView({backgroundColor:"#FFFFFF",borderRadius:10,borderColor:"#333333",borderWidth:"5dip",visible:!1,top:"46%",left:c("x",50)-_/4,height:"8%",width:_/2,zIndex:700}),R=Ti.UI.createActivityIndicator({color:"#333333",font:{fontSize:"14dip",fontWeight:"bold"},message:"Loading...",style:"iPhone OS"===Ti.Platform.name?Ti.UI.iPhone.ActivityIndicatorStyle.DARK:Ti.UI.ActivityIndicatorStyle.DARK,height:"100%",width:"100%"});b.add(R),v.add(b);var A=Ti.UI.createImageView({height:"100%",width:"100%",backgroundImage:"/assets/inventoryBackground.png"});v.add(A);var w=Titanium.UI.createImageView({height:"8.5%",width:"100%",bottom:"92.5%",image:"/assets/overlayTitleStarCurtains.png"});v.add(w);var S=Titanium.UI.createLabel({text:"SIGN IN",textAlign:"center",color:"#4dd28f",font:{fontStyle:"Century Gothic",fontSize:"16dip"},top:"1",height:"4.9%"});v.add(S);var x=Ti.UI.createImageView({top:"12%",height:"30%",width:"52%",image:"/assets/app_logo2.png"});v.add(x);var U=(Ti.UI.createLabel({text:"debuggers:",color:"#000000",font:{fontSize:12},top:"12%",left:0,textAlign:"left"}),Ti.UI.createButton({color:"#761f56",title:"New User?",color:"white",top:"44%",width:"75%",height:"10%",backgroundGradient:{type:"linear",startPoint:{x:"0%",y:"0%"},endPoint:{x:"0%",y:"100%"},colors:[{color:"#21653d",offset:0},{color:"#00321f",offset:.25},{color:"#21653d",offset:1}]},borderColor:"#b3fad0",borderRadius:"7",borderWidth:"1dip"}));v.add(U),U.addEventListener("click",function(){var e=require("/ui/common/MenuScreen/ChooseClass");u=new e,u.open()});var y=Titanium.UI.createTextField({height:"8.5%",font:{fontSize:"12dip"},hintText:"Email",left:"12.5%",width:"75%",paddingLeft:10,value:"robot2@email.com",borderRadius:0,borderColor:"#333333",backgroundColor:"#FFFFFF",keyboardType:Ti.UI.KEYBOARD_EMAIL,top:"55%",zIndex:10});v.add(y),("iphone"===p||"ipad"===p)&&(y.addEventListener("focus",function(){y.animate({top:"45%",duration:500})}),y.addEventListener("blur",function(){y.animate({top:"55%",duration:500})}));var L=Titanium.UI.createTextField({height:"8.5%",font:{fontSize:"12dip"},hintText:"Password",paddingLeft:10,left:"12.5%",width:"75%",value:"test",borderRadius:0,borderColor:"#333333",passwordMask:!0,backgroundColor:"#FFFFFF",top:"65%",zIndex:10});("iphone"===p||"ipad"===p)&&(L.addEventListener("focus",function(){L.animate({top:"45%",duration:500})}),L.addEventListener("blur",function(){L.animate({top:"65%",duration:500})})),"android"!==p?(L.borderRadius="5",L.backgroundColor="#FFFFFF"):L.value=Ti.App.Properties.getString("knp_password"),v.add(L);var k=Ti.UI.createSwitch({top:"73.5%",style:"android"===p?Ti.UI.Android.SWITCH_STYLE_CHECKBOX:"",height:"auto",left:"12%",value:!1});"android"===p&&v.add(k),k.addEventListener("change",function(e){g=e.value});var P=Ti.UI.createLabel({top:"68%",left:"26%",text:"Remember me",height:"20%",font:{fontSize:"14dip"},zIndex:5});"android"===p&&v.add(P);var N=Ti.UI.createButton({color:"#761f56",title:"Forget Password",height:"auto",width:"75%",color:"#FFF",top:"92%",backgroundGradient:{type:"linear",startPoint:{x:"0%",y:"0%"},endPoint:{x:"0%",y:"100%"},colors:[{color:"#21653d",offset:0},{color:"#00321f",offset:.25},{color:"#21653d",offset:1}]},borderColor:"#b3fad0",borderRadius:"7",borderWidth:"1dip"});N.addEventListener("click",function(){if(""==y.value)return alert("Please enter your email address"),void 0;R.show(),b.visible=!0,R.message="Sending code...";var e=require("/ui/common/Functions/function");e.requestServer({success:function(){if(retreive_code_json=JSON.parse(this.responseText),R.hide(),b.visible=!1,1==retreive_code_json.Record.Error)return alert(retreive_code_json.Record.Message),void 0;var e=Titanium.UI.createAlertDialog({title:"Password reset request",message:"Password reset code has been sent to "+y.value,buttonNames:["OK"]});e.show(),e.addEventListener("click",function(){var e=require("/ui/common/MenuScreen/ForgetPassword");forgetpassword=new e(y.value),forgetpassword.open({modal:!0})})},method:"GET",contentType:"text/xml",url:"http://bonozo.com:8080/knp/get_password_reset_code.php?email="+Ti.Network.encodeURIComponent(y.value)})}),v.add(N);var M=Ti.UI.createButton({color:"#761f56",title:"Sign In",top:"82%",color:"white",width:"75%",height:"8%",backgroundGradient:{type:"linear",startPoint:{x:"0%",y:"0%"},endPoint:{x:"0%",y:"100%"},colors:[{color:"#21653d",offset:0},{color:"#00321f",offset:.25},{color:"#21653d",offset:1}]},borderColor:"#b3fad0",borderRadius:"7",borderWidth:"1dip"});return function(){("iphone"===p||"ipad"===p)&&(U.backgroundImage="/assets/overlayItemList.png",N.backgroundImage="/assets/overlayItemList.png",M.backgroundImage="/assets/overlayItemList.png")}(),v.add(M),M.addEventListener("touchstart",function(){}),M.addEventListener("touchend",function(){}),M.addEventListener("click",function(){l(y,L)}),Ti.App.addEventListener("close_screen",function(e){if("choose_your_class"==e.screen_name&&null!=u)u.close(),u=null;else{var t=Titanium.Android.currentActivity;t.finish()}}),v.addEventListener("android:back",function(){var e=Titanium.Android.currentActivity;e.finish()}),v.addEventListener("open",function(){"iPhone OS"===Ti.Platform.name&&(U.backgroundColor="#1a3425",M.backgroundColor="#1a3425",N.backgroundColor="#1a3425")}),"android"===p&&(f.addEventListener("callback",function(){}),f.addEventListener("trayClickLaunchedApp",function(){}),f.addEventListener("trayClickFocusedApp",function(){})),function(){if(Ti.App.Properties.getBool("signed_in")&&null!=Ti.App.Properties.getString("knp_email")&&null!=Ti.App.Properties.getString("knp_password")){var e={value:Ti.App.Properties.getString("knp_email")},t={value:Ti.App.Properties.getString("knp_password")};l(e,t)}else Ti.App.Properties.setBool("signed_in",!1)}(),Ti.App.addEventListener("signed_in",function(){I.hide(),R.hide(),b.visible=!1}),v}module.exports=LoginWindow;